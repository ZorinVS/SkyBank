# SkyBank — анализ банковских операций

## Описание

Этот проект представляет собой приложение для анализа транзакций, находящихся в Excel-файле. Основные функции приложения включают:

- **Генерация JSON-данных**: Приложение генерирует JSON-данные для веб-страниц на основе транзакций.
- **Формирование отчетов**: Приложение создает отчеты в формате Excel с анализом транзакций.
- **Дополнительные сервисы**: Приложение предоставляет различные дополнительные сервисы, такие как получение курсов валют и цен на акции.

### Основные возможности

- Загрузка и обработка транзакций из Excel-файла.
- Фильтрация транзакций по дате и категории.
- Генерация отчетов и JSON-данных для дальнейшего использования на веб-страницах.
- Интеграция с внешними API для получения актуальной информации о курсах валют и ценах на акции.

## Функциональность

SkyBank включает следующие модули:

- main.py
- reports.py
- services.py
- utils.py
- views.py

### Обзор функциональных модулей:

#### main.py
Основной модуль, который обеспечивает запуск приложения и взаимодействие с другими модулями для обработки данных.

#### reports.py
Модуль, отвечающий за генерацию отчетов на основе данных о транзакциях. 
Основные функции модуля включают:
- report_decorator: Декоратор, который записывает результат функции-отчета в файл. Если имя файла не указано, используется имя по умолчанию, содержащее текущую дату и время.
- spending_by_category: Функция, которая возвращает траты по заданной категории за последние три месяца от переданной даты. Функция фильтрует транзакции по категории и дате, а затем возвращает отфильтрованный DataFrame.

#### services.py
Модуль, предоставляющий функционал простого поиска. 
Основные функции модуля включают:
- dataframe_to_dict_with_str: Преобразует DataFrame в список словарей, где значения полей "Категория" и "Описание" представлены в виде строк. Если значение не строка, оно преобразуется в строку.
- search_transactions: Ищет транзакции по описанию или категории и возвращает JSON-ответ со всеми транзакциями, содержащими запрос в описании или категории.

#### utils.py
Модуль, содержащий функции для обработки данных и выполнения операций, связанных с веб-страницами. 
Основные функции включают:
- determine_time_of_day: Определяет время суток на основе текущего времени и возвращает соответствующее приветствие.
- generate_greeting: Генерирует приветственное сообщение на основе входной строки с датой и временем.
- load_transactions: Загружает данные из Excel-файла и возвращает их в виде DataFrame.
- filter_transactions_by_date: Фильтрует транзакции по заданной дате и возвращает соответствующий DataFrame.
- calculate_card_info: Вычисляет информацию по картам, включая общую сумму расходов и кешбэк.
- get_top_5_transactions: Определяет топ-5 транзакций по сумме платежа и возвращает их в виде списка словарей.
- load_and_extract_user_settings: Загружает настройки пользователя из файла JSON и извлекает валюты и акции.
- fetch_currency_rates: Получает курсы валют с ExchangeRate-API относительно базовой валюты и преобразует их к рублям.
- fetch_stock_prices: Получает цены (USD) на акции с Finnhub API.

#### views.py
Модуль, отвечающий за формирование и представление JSON-ответов на основе обработанных данных. 
Основная функция:
- form_json_response: Формирует JSON-ответ, объединяя приветственное сообщение, информацию по картам, топ-5 транзакций, курсы валют и цены на акции в единый JSON-объект.

## Зависимости

Python 3.12
requests 2.32.3
types-requests 2.32.0.20249712
flake8 7.0.0
black 24.4.2
isort 5.13.2
mypy 1.10.0
pytest 8.2.2
pytest-cov 5.0.0
python-dotenv 1.0.1
openpyxl 3.1.5
pandas-stubs 2.2.2.240603

## Установка

1. Клонируйте репозиторий:
```bash
git clone git@github.com:ZorinVS/SkyBank.git
```
2. Установите зависимости:
```bash
poetry install
```

## Тестирование проекта

Тестирование проекта проводится с использованием пакета tests, который включает следующие файлы:

- init.py
- conftest.py
- test_reports.py
- test_services.py
- test_utils.py
- test_views.py

### Есть два способа выполнить тестирование проекта:
1. Используя терминал PyCharm:
```bash
pytest tests
```
2. Используя функциональность PyCharm:
- Откройте окно **Edit Configurations**.
- Выберите **pytest**.
- Укажите директорию, содержащую тесты, и директорию проекта.
- Подтвердите изменения, нажав **Apply** и **OK**.
- Запустите **pytest in tests**

## Документация:

Для получения дополнительной информации, пожалуйста, свяжитесь с...

## Лицензия:

Этот проект лицензирован в соответствии с условиями [MIT License](LICENSE).